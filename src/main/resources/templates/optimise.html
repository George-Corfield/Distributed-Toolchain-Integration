<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Optimise</title>
</head>

<body>
    <h1 th:text="${part.partName}"></h1>
    <h3 th:text="${part.partDescription}"></h3>
    <br>

    <h2><strong>Optimisation Parameters</strong></h2>
    <h3>Iteration Limit:</h3><span th:text="${opParams.iterations}"></span>
    <h3>Modules:</h3>
    <ol th:each="var : ${opParams.modules}">
        <li th:text="${var}"></li>
    </ol>

    <div class="opParams-form-popup" id="op-form" style="display:block;">
        <form class="form" action="#" th:action="@{'/projects/' + ${projectName} + '/' + ${part.partId} + '/optimise'}" th:object="${newOp}" method="post">
            <h1>Change Optimisation Parameters</h1>

            <label for="opParamsIterations"><b>Iteration Limit</b></label>
            <input type="number" th:placeholder="'Current: ' + ${opParams.iterations}" th:field="*{iterations}" th:value="${opParams.iterations}"/>

            <label for="opParamsModuleChoices"><b>Modules</b></label>
            <div id="Options">
                <div class="moduleOption">
                    <select id="module" th:each="var : ${opParams.modules}">
                        <option th:value="${var}" th:text="${var.fileName}"></option>
                    </select>
                    <button type="button" th:onclick="addModOption([[${opParams}]])">Add</button>
                    <button type="button" onclick="delModOption(this)">Delete</button>
                </div>
            </div>
            

            <button type="submit">Submit</button>
        </form>
    </div>
</body>
<script>

    function addModOption(opParams){
        var container = document.createElement('div');
        container.classList.add("moduleOption");

        var select = document.createElement('select');
        select.id = 'module';

        console.log(opParams)

        opParams.modules.forEach(function(module){
            var option = document.createElement('option');
            option.value = module;
            option.textContent=module.fileName;
            select.appendChild(option);
        })

        var addButton = document.createElement('button');
        addButton.type = 'button';
        addButton.textContent = 'Add';
        addButton.onclick = function() {
            addModOption(opParams);
        }

        var deleteButton = document.createElement('button');
        deleteButton.type = 'button';
        deleteButton.textContent = 'Delete';
        deleteButton.onclick = function() {
            delModOption(this);
        }

        container.appendChild(select);
        container.appendChild(addButton);
        container.appendChild(deleteButton);

        console.log(container);

        document.getElementById("Options").append(container);
    }

    function delModOption(button){
        document.getElementById("Options").removeChild(button.parentNode);

    }
</script>
</html>